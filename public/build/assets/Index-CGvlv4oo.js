import{u as $,r as u,b as B,z as j,j as e,H as V,L as D,a as k}from"./app-DtJ35xiz.js";import{A as T}from"./AdminLayout-BH41KSEt.js";import{M as I,C as z}from"./ConfirmDialog-DwnvgXmc.js";import{B as _}from"./Button-MploRZnw.js";import{S as F}from"./SearchBox-CSScaDuk.js";import{S as q}from"./SelectChain-AmMfXIqx.js";import{o as U,s as K}from"./schemas-DYt2ce8c.js";import"./Badge-bqPMSCrt.js";import"./AOSWrapper-CyGhR2Oq.js";const W=U({kec_id:K().min(1,"Kecamatan wajib dipilih"),nm_kel:K().min(1,"Nama kelurahan wajib diisi").max(255,"Nama kelurahan maksimal 255 karakter")});function se({auth:C,kelurahan:l,provinsi:M,kabKota:g,kecamatan:v,filters:o}){const{flash:c}=$().props,[L,N]=u.useState(!1),[O,p]=u.useState(!1),[r,d]=u.useState(null),{data:t,setData:m,processing:h,errors:x,reset:A}=B({prov_id:"",kab_id:"",kec_id:"",nm_kel:""});u.useEffect(()=>{c?.success&&j.success(c.success),c?.error&&j.error(c.error)},[c]);const S=(a=null)=>{if(a){d(a);const s=v.find(n=>n.id===a.kec_id),f=s?g.find(n=>n.id===s.kab_id):null;m({prov_id:f?String(f.prov_id):"",kab_id:s?String(s.kab_id):"",kec_id:String(a.kec_id),nm_kel:a.nm_kel})}else d(null),m({prov_id:"",kab_id:"",kec_id:o?.kec_id||"",nm_kel:""});N(!0)},b=()=>{N(!1),d(null),A()},w=a=>{a.preventDefault();const s={kec_id:t.kec_id,nm_kel:t.nm_kel};W.safeParse(s).success&&(r?k.patch(`/admin/kelurahan/${r.id}`,s,{preserveScroll:!0,onSuccess:()=>{b()},onError:n=>{if(console.error("Update error:",n),n&&Object.keys(n).length>0&&!n.message){const i=Object.values(n)[0];j.error(Array.isArray(i)?i[0]:i)}}}):k.post("/admin/kelurahan",s,{preserveScroll:!0,onSuccess:()=>{b()},onError:n=>{if(console.error("Create error:",n),n&&Object.keys(n).length>0&&!n.message){const i=Object.values(n)[0];j.error(Array.isArray(i)?i[0]:i)}}}))},H=a=>{d(a),p(!0)},P=()=>{r&&k.delete(`/admin/kelurahan/${r.id}`,{preserveScroll:!0,onSuccess:()=>{p(!1),d(null)},onError:a=>{console.error("Delete error:",a),p(!1)}})},E=a=>{const s=a.target.value;k.get("/admin/kelurahan",{...o,kec_id:s||null},{preserveState:!0,replace:!0})},y=t.kab_id?v.filter(a=>String(a.kab_id)===String(t.kab_id)):[];return u.useEffect(()=>{t.kab_id&&t.kec_id&&(y.some(s=>String(s.id)===String(t.kec_id))||m("kec_id",""))},[t.kab_id]),e.jsxs(T,{auth:C,children:[e.jsx(V,{title:"Manajemen Kelurahan"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4","data-aos":"fade-down",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Manajemen Kelurahan"}),e.jsx("p",{className:"text-base-content/70 mt-1",children:"Kelola data kelurahan di Indonesia"})]}),e.jsxs(_,{onClick:()=>S(),variant:"primary",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})}),"Tambah Kelurahan"]})]}),e.jsx("div",{className:"card bg-base-100 shadow-sm","data-aos":"fade-up","data-aos-delay":"100",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"grid grid-cols-1 items-end justify-end gap-4 md:grid-cols-2",children:[e.jsx(F,{placeholder:"Cari kelurahan, kecamatan, kabupaten/kota, atau provinsi...",defaultValue:o?.search||"",route:"/admin/kelurahan",routeParams:o,debounceMs:500}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Filter Kecamatan"})}),e.jsxs("select",{className:"select select-bordered w-full",value:o?.kec_id||"",onChange:E,children:[e.jsx("option",{value:"",children:"Semua Kecamatan"}),v.map(a=>e.jsxs("option",{value:a.id,children:[a.nm_kec," - ",a.kab_kota?.nm_kab," - ",a.kab_kota?.provinsi?.nm_prov]},a.id))]})]})]})})}),e.jsx("div",{className:"card bg-base-100 shadow-sm","data-aos":"fade-up","data-aos-delay":"200",children:e.jsxs("div",{className:"card-body p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table table-zebra",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Nama Kelurahan"}),e.jsx("th",{children:"Kecamatan"}),e.jsx("th",{children:"Kabupaten/Kota"}),e.jsx("th",{children:"Provinsi"}),e.jsx("th",{className:"text-right",children:"Aksi"})]})}),e.jsx("tbody",{children:l.data.length>0?l.data.map((a,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:l.from+s}),e.jsx("td",{children:e.jsx("div",{className:"font-medium",children:a.nm_kel})}),e.jsx("td",{children:e.jsx("div",{className:"text-sm text-base-content/70",children:a.kecamatan?.nm_kec||"-"})}),e.jsx("td",{children:e.jsx("div",{className:"text-sm text-base-content/70",children:a.kecamatan?.kab_kota?.nm_kab||"-"})}),e.jsx("td",{children:e.jsx("div",{className:"text-sm text-base-content/50",children:a.kecamatan?.kab_kota?.provinsi?.nm_prov||"-"})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>S(a),children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Ubah"]}),e.jsxs("button",{className:"btn btn-sm btn-error",onClick:()=>H(a),children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Hapus"]})]})})]},a.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-8 text-base-content/50",children:e.jsx("p",{children:"Tidak ada data kelurahan"})})})})]})}),l.links&&l.links.length>3&&e.jsx("div",{className:"card-body border-t border-base-300",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"text-sm text-base-content/70",children:["Menampilkan ",l.from," sampai ",l.to," dari ",l.total," data"]}),e.jsx("div",{className:"join",children:l.links.map((a,s)=>e.jsx(D,{href:a.url||"#",className:`join-item btn btn-sm ${a.active?"btn-active":a.url?"":"btn-disabled"}`,dangerouslySetInnerHTML:{__html:a.label}},s))})]})})]})})]}),e.jsx(I,{id:"kelurahan-modal",isOpen:L,onClose:b,title:r?"Ubah Kelurahan":"Tambah Kelurahan",size:"md",footer:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(_,{variant:"ghost",onClick:b,disabled:h,children:"Batal"}),e.jsx(_,{type:"submit",variant:"primary",onClick:w,disabled:h,loading:h,children:r?"Simpan Perubahan":"Tambah"})]}),children:e.jsxs("form",{onSubmit:w,className:"space-y-4",noValidate:!0,children:[e.jsx(q,{levels:[{name:"prov_id",label:"Provinsi",options:M,optionValue:"id",optionLabel:"nm_prov",required:!0,placeholder:"Pilih Provinsi"},{name:"kab_id",label:"Kabupaten/Kota",options:g,optionValue:"id",optionLabel:a=>`${a.nm_kab} - ${a.provinsi?.nm_prov||""}`,dependsOn:"prov_id",foreignKey:"prov_id",required:!0,placeholder:"Pilih Kabupaten/Kota"},{name:"kec_id",label:"Kecamatan",options:y,optionValue:"id",optionLabel:a=>`${a.nm_kec} - ${a.kab_kota?.nm_kab||""}`,dependsOn:"kab_id",filterFn:(a,s)=>String(a.kab_id)===String(s),required:!0,placeholder:"Pilih Kecamatan"}],values:t,onChange:(a,s)=>m(a,s),errors:x,disabled:h}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Nama Kelurahan ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsx("input",{type:"text",className:`input input-bordered w-full ${x.nm_kel?"input-error":""}`,placeholder:"Masukkan nama kelurahan",value:t.nm_kel,onChange:a=>m("nm_kel",a.target.value),disabled:h}),x.nm_kel&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:x.nm_kel})})]})]})}),e.jsx(z,{isOpen:O,onClose:()=>{p(!1),d(null)},onConfirm:P,title:"Hapus Kelurahan",message:`Apakah Anda yakin ingin menghapus "${r?.nm_kel}"?`,confirmText:"Hapus",cancelText:"Batal",variant:"error"})]})}export{se as default};
