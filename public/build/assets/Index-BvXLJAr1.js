import{u as W,r as d,z as g,j as e,H as R,a as f}from"./app-DtJ35xiz.js";import{M as z,C as U}from"./ConfirmDialog-DwnvgXmc.js";import{B as _}from"./Button-MploRZnw.js";import{S as J}from"./SearchBox-CSScaDuk.js";import{A as q}from"./AdminLayout-BH41KSEt.js";import{u as D,o as Q,c as X,d as h,b as Y}from"./index.esm-BBRPuYfN.js";import{L as Z}from"./styles-CWGc3PHY.js";import"./Badge-bqPMSCrt.js";import"./AOSWrapper-CyGhR2Oq.js";const ee=X({judul:h().nullable().max(255,"Judul maksimal 255 karakter"),desk:h().nullable(),gambar:Y().nullable(),tipe:h().nullable().oneOf(["kegiatan","fasilitas","umum"],"Tipe tidak valid"),kegiatan_id:h().nullable(),fasilitas_id:h().nullable()});function ce({auth:$,galeri:c,kegiatan:E,fasilitas:L,filters:y}){const{flash:u}=W().props,[O,w]=d.useState(!1),[I,j]=d.useState(!1),[r,m]=d.useState(null),[k,p]=d.useState(null),b=d.useRef(null),[G,S]=d.useState(!1),[A,H]=d.useState(0);d.useEffect(()=>{u?.success&&g.success(u.success),u?.error&&g.error(u.error)},[u]),d.useEffect(()=>{const a="lightbox-blur-styles";if(!document.getElementById(a)){const s=document.createElement("style");s.id=a,s.textContent=`
                .yarl__backdrop {
                    backdrop-filter: blur(16px) !important;
                    -webkit-backdrop-filter: blur(16px) !important;
                    background-color: rgba(0, 0, 0, 0.2) !important;
                }
                .yarl__container {
                    background-color: transparent !important;
                }
                .yarl__root {
                    --yarl__color_backdrop: rgba(0, 0, 0, 0.2) !important;
                }
                .yarl__root .yarl__backdrop {
                    backdrop-filter: blur(16px) !important;
                    -webkit-backdrop-filter: blur(16px) !important;
                    background-color: rgba(0, 0, 0, 0.2) !important;
                }
                /* Ensure parent elements support backdrop-filter */
                .yarl__root,
                .yarl__root > div {
                    backdrop-filter: blur(16px) !important;
                    -webkit-backdrop-filter: blur(16px) !important;
                }
            `,document.head.appendChild(s)}},[]);const{register:o,handleSubmit:B,reset:N,setValue:l,watch:C,formState:{errors:t,isSubmitting:M}}=D({resolver:Q(ee),defaultValues:{judul:"",desk:"",gambar:null,tipe:"umum",kegiatan_id:"",fasilitas_id:""}});C("gambar");const x=C("tipe");d.useEffect(()=>{x==="kegiatan"?l("fasilitas_id",""):x==="fasilitas"?l("kegiatan_id",""):(l("kegiatan_id",""),l("fasilitas_id",""))},[x,l]);const F=(a=null)=>{if(a){m(a);const s=a.judul&&a.judul!=="null"?a.judul:"";l("judul",s),l("desk",a.desk||""),l("gambar",null),p(a.gambar?`/storage/${a.gambar}`:null),a.kegiatan&&a.kegiatan.length>0?(l("tipe","kegiatan"),l("kegiatan_id",String(a.kegiatan[0].id)),l("fasilitas_id","")):a.fasilitas&&a.fasilitas.length>0?(l("tipe","fasilitas"),l("fasilitas_id",String(a.fasilitas[0].id)),l("kegiatan_id","")):(l("tipe","umum"),l("kegiatan_id",""),l("fasilitas_id",""))}else m(null),N({judul:"",desk:"",gambar:null,tipe:"umum",kegiatan_id:"",fasilitas_id:""}),p(null);w(!0)},v=()=>{w(!1),m(null),p(null),b.current&&(b.current.value=""),N({judul:"",desk:"",gambar:null,tipe:"umum",kegiatan_id:"",fasilitas_id:""})},P=a=>{const s=a.target.files[0];if(s){l("gambar",s);const i=new FileReader;i.onloadend=()=>{p(i.result)},i.readAsDataURL(s)}},T=a=>{if(!r&&!(a.gambar instanceof File)){g.error("Gambar wajib diupload");return}const s=new FormData;s.append("judul",a.judul),a.desk&&s.append("desk",a.desk),a.tipe&&s.append("tipe",a.tipe),a.tipe==="kegiatan"&&a.kegiatan_id&&s.append("kegiatan_id",a.kegiatan_id),a.tipe==="fasilitas"&&a.fasilitas_id&&s.append("fasilitas_id",a.fasilitas_id),r?(a.gambar instanceof File&&s.append("gambar",a.gambar),s.append("_method","PATCH"),f.post(`/admin/galeri/${r.id}`,s,{preserveScroll:!0,forceFormData:!0,onSuccess:()=>{v()},onError:i=>{if(console.error("Update error:",i),i&&Object.keys(i).length>0&&!i.message){const n=Object.values(i)[0];g.error(Array.isArray(n)?n[0]:n)}}})):(a.gambar instanceof File&&s.append("gambar",a.gambar),f.post("/admin/galeri",s,{preserveScroll:!0,forceFormData:!0,onSuccess:()=>{N({judul:"",desk:"",gambar:null,tipe:"umum",kegiatan_id:"",fasilitas_id:""}),p(null),b.current&&(b.current.value="")},onError:i=>{if(console.error("Create error:",i),i&&Object.keys(i).length>0&&!i.message){const n=Object.values(i)[0];g.error(Array.isArray(n)?n[0]:n)}}}))},K=a=>{m(a),j(!0)},V=()=>{r&&f.delete(`/admin/galeri/${r.id}`,{preserveScroll:!0,onSuccess:()=>{j(!1),m(null)},onError:a=>{console.error("Delete error:",a),j(!1)}})};return e.jsxs(q,{auth:$,children:[e.jsx(R,{title:"Manajemen Galeri"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center","data-aos":"fade-down",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-base-content",children:"Manajemen Galeri"}),e.jsx("p",{className:"mt-1 text-base-content/70",children:"Kelola data galeri foto"})]}),e.jsxs(_,{onClick:()=>F(),className:"btn-primary",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})}),"Tambah Galeri"]})]}),e.jsx("div",{className:"card bg-base-100 shadow-sm","data-aos":"fade-up","data-aos-delay":"100",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"grid grid-cols-1 items-end justify-end gap-4 md:grid-cols-2",children:e.jsx(J,{placeholder:"Cari galeri...",defaultValue:y?.search||"",route:"/admin/galeri",routeParams:y,debounceMs:500})})})}),e.jsx("div",{className:"card bg-base-100 shadow-sm","data-aos":"fade-up","data-aos-delay":"200",children:e.jsx("div",{className:"card-body",children:c.data.length===0?e.jsx("div",{className:"py-12 text-center text-base-content/70",children:"Tidak ada data galeri"}):e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4",children:c.data.map(a=>e.jsxs("div",{className:"card bg-base-200 shadow-sm",children:[e.jsx("figure",{className:"aspect-square cursor-pointer",onClick:()=>{const i=c.data.filter(n=>n.gambar).findIndex(n=>n.id===a.id);H(i>=0?i:0),S(!0)},children:e.jsx("img",{src:a.gambar?`/storage/${a.gambar}`:"/placeholder-image.jpg",alt:a.judul&&a.judul!=="null"?a.judul:"Galeri",className:"h-full w-full object-cover"})}),e.jsxs("div",{className:"card-body p-4",children:[e.jsx("h3",{className:"card-title text-sm",children:a.judul}),e.jsx("p",{className:"line-clamp-2 text-xs text-base-content/70",children:a.desk}),a.kegiatan&&a.kegiatan.length>0&&e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"badge badge-sm badge-primary",children:["Kegiatan: ",a.kegiatan[0].nm_kegiatan]})}),a.fasilitas&&a.fasilitas.length>0&&e.jsx("div",{className:"mt-2",children:e.jsxs("span",{className:"badge badge-sm badge-secondary",children:["Fasilitas: ",a.fasilitas[0].nm_fasilitas]})}),e.jsxs("div",{className:"mt-2 card-actions justify-end",children:[e.jsx("button",{className:"btn btn-ghost btn-xs",onClick:()=>F(a),title:"Edit",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{className:"btn text-error btn-ghost btn-xs",onClick:()=>K(a),title:"Hapus",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]},a.id))})})}),c.links.length>3&&e.jsx("div",{className:"flex justify-center","data-aos":"fade-up","data-aos-delay":"300",children:e.jsx("div",{className:"join",children:c.links.map((a,s)=>e.jsx("button",{className:`btn join-item ${a.active?"btn-active":""} ${a.url?"":"btn-disabled"}`,onClick:()=>a.url&&f.get(a.url),dangerouslySetInnerHTML:{__html:a.label}},s))})}),e.jsx(z,{isOpen:O,onClose:v,title:r?"Edit Galeri":"Tambah Galeri",size:"3xl",children:e.jsxs("form",{onSubmit:B(T),className:"space-y-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Judul (Opsional)"})}),e.jsx("input",{type:"text",className:`input-bordered input w-full ${t.judul?"input-error":""}`,...o("judul"),placeholder:"Masukkan judul galeri"}),t.judul&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:t.judul.message})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Deskripsi (Opsional)"})}),e.jsx("textarea",{className:`textarea-bordered textarea w-full ${t.desk?"textarea-error":""}`,...o("desk"),placeholder:"Masukkan deskripsi galeri",rows:"3"}),t.desk&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:t.desk.message})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Tipe"})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"label cursor-pointer gap-2",children:[e.jsx("input",{type:"radio",className:"radio radio-primary",value:"umum",...o("tipe")}),e.jsx("span",{className:"label-text",children:"Umum"})]}),e.jsxs("label",{className:"label cursor-pointer gap-2",children:[e.jsx("input",{type:"radio",className:"radio radio-primary",value:"kegiatan",...o("tipe")}),e.jsx("span",{className:"label-text",children:"Kegiatan"})]}),e.jsxs("label",{className:"label cursor-pointer gap-2",children:[e.jsx("input",{type:"radio",className:"radio radio-primary",value:"fasilitas",...o("tipe")}),e.jsx("span",{className:"label-text",children:"Fasilitas"})]})]}),t.tipe&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:t.tipe.message})})]}),x==="kegiatan"&&e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Kegiatan ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsxs("select",{className:`select-bordered select w-full ${t.kegiatan_id?"select-error":""}`,...o("kegiatan_id"),children:[e.jsx("option",{value:"",children:"Pilih Kegiatan"}),E.map(a=>e.jsx("option",{value:a.id,children:a.nm_kegiatan},a.id))]}),t.kegiatan_id&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:t.kegiatan_id.message})})]}),x==="fasilitas"&&e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Fasilitas ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsxs("select",{className:`select-bordered select w-full ${t.fasilitas_id?"select-error":""}`,...o("fasilitas_id"),children:[e.jsx("option",{value:"",children:"Pilih Fasilitas"}),L.map(a=>e.jsx("option",{value:a.id,children:a.nm_fasilitas},a.id))]}),t.fasilitas_id&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:t.fasilitas_id.message})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Gambar ",e.jsx("span",{className:"text-error",children:r?"":"*"})]})}),e.jsx("input",{ref:b,type:"file",accept:"image/*",className:"file-input-bordered file-input w-full",onChange:P}),k&&e.jsx("div",{className:"mt-4",children:e.jsx("img",{src:k,alt:"Preview",className:"max-h-64 rounded-lg object-cover"})}),t.gambar&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:t.gambar.message})}),r&&!k&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-base-content/50",children:"Kosongkan jika tidak ingin mengubah gambar"})})]}),e.jsxs("div",{className:"modal-action",children:[e.jsx(_,{type:"button",onClick:v,className:"btn-ghost",children:"Batal"}),e.jsx(_,{type:"submit",className:"btn-primary",disabled:M,children:M?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading loading-sm loading-spinner"}),r?"Menyimpan...":"Menambahkan..."]}):r?"Simpan Perubahan":"Tambah Galeri"})]})]})}),e.jsx(U,{isOpen:I,onClose:()=>{j(!1),m(null)},onConfirm:V,title:"Hapus Galeri",message:`Apakah Anda yakin ingin menghapus galeri ${r?.judul?`"${r.judul}"`:"ini"}?`}),e.jsx(Z,{open:G,close:()=>S(!1),index:A,slides:c.data.filter(a=>a.gambar).map(a=>({src:`/storage/${a.gambar}`,alt:a.judul&&a.judul!=="null"?a.judul:"Galeri",description:a.desk||void 0})),styles:{container:{backgroundColor:"transparent"},backdrop:{backdropFilter:"blur(16px)",WebkitBackdropFilter:"blur(16px)",backgroundColor:"rgba(0, 0, 0, 0.2)"}}})]})]})}export{ce as default};
