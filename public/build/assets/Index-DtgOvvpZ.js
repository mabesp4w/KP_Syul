import{u as P,r as b,z as j,b as B,j as e,H as E,L as D,a as v}from"./app-DtJ35xiz.js";import{A as T}from"./AdminLayout-BH41KSEt.js";import{M as $,C as I}from"./ConfirmDialog-DwnvgXmc.js";import{B as k}from"./Button-MploRZnw.js";import{S as z}from"./SearchBox-CSScaDuk.js";import{S as V}from"./SelectChain-AmMfXIqx.js";import{o as F,s as y}from"./schemas-DYt2ce8c.js";import"./Badge-bqPMSCrt.js";import"./AOSWrapper-CyGhR2Oq.js";const U=F({kab_id:y().min(1,"Kabupaten/Kota wajib dipilih"),nm_kec:y().min(1,"Nama kecamatan wajib diisi").max(255,"Nama kecamatan maksimal 255 karakter")});function ee({auth:K,kecamatan:t,provinsi:S,kabKota:f,filters:o}){const{flash:d}=P().props,[C,g]=b.useState(!1),[M,m]=b.useState(!1),[r,i]=b.useState(null);b.useEffect(()=>{d?.success&&j.success(d.success),d?.error&&j.error(d.error)},[d]);const{data:h,setData:p,processing:c,errors:x,reset:L}=B({prov_id:"",kab_id:"",nm_kec:""}),_=(a=null)=>{if(a){i(a);const s=f.find(w=>w.id===a.kab_id);p({prov_id:s?String(s.prov_id):"",kab_id:String(a.kab_id),nm_kec:a.nm_kec})}else i(null),p({prov_id:"",kab_id:o?.kab_id||"",nm_kec:""});g(!0)},u=()=>{g(!1),i(null),L()},N=a=>{a.preventDefault();const s={kab_id:h.kab_id,nm_kec:h.nm_kec};U.safeParse(s).success&&(r?v.patch(`/admin/kecamatan/${r.id}`,s,{preserveScroll:!0,onSuccess:()=>{u()},onError:n=>{if(console.error("Update error:",n),n&&Object.keys(n).length>0&&!n.message){const l=Object.values(n)[0];j.error(Array.isArray(l)?l[0]:l)}}}):v.post("/admin/kecamatan",s,{preserveScroll:!0,onSuccess:()=>{u()},onError:n=>{if(console.error("Create error:",n),n&&Object.keys(n).length>0&&!n.message){const l=Object.values(n)[0];j.error(Array.isArray(l)?l[0]:l)}}}))},O=a=>{i(a),m(!0)},A=()=>{r&&v.delete(`/admin/kecamatan/${r.id}`,{preserveScroll:!0,onSuccess:()=>{m(!1),i(null)},onError:a=>{console.error("Delete error:",a),m(!1)}})},H=a=>{const s=a.target.value;v.get("/admin/kecamatan",{...o,kab_id:s||null},{preserveState:!0,replace:!0})};return e.jsxs(T,{auth:K,children:[e.jsx(E,{title:"Manajemen Kecamatan"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4","data-aos":"fade-down",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Manajemen Kecamatan"}),e.jsx("p",{className:"text-base-content/70 mt-1",children:"Kelola data kecamatan di Indonesia"})]}),e.jsxs(k,{onClick:()=>_(),variant:"primary",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})}),"Tambah Kecamatan"]})]}),e.jsx("div",{className:"card bg-base-100 shadow-sm","data-aos":"fade-up","data-aos-delay":"100",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"grid grid-cols-1 items-end justify-end gap-4 md:grid-cols-2",children:[e.jsx(z,{placeholder:"Cari kecamatan, kabupaten/kota, atau provinsi...",defaultValue:o?.search||"",route:"/admin/kecamatan",routeParams:o,debounceMs:500}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Filter Kabupaten/Kota"})}),e.jsxs("select",{className:"select select-bordered w-full",value:o?.kab_id||"",onChange:H,children:[e.jsx("option",{value:"",children:"Semua Kabupaten/Kota"}),f.map(a=>e.jsxs("option",{value:a.id,children:[a.nm_kab," - ",a.provinsi?.nm_prov]},a.id))]})]})]})})}),e.jsx("div",{className:"card bg-base-100 shadow-sm","data-aos":"fade-up","data-aos-delay":"200",children:e.jsxs("div",{className:"card-body p-0",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table table-zebra",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Nama Kecamatan"}),e.jsx("th",{children:"Kabupaten/Kota"}),e.jsx("th",{children:"Provinsi"}),e.jsx("th",{className:"text-right",children:"Aksi"})]})}),e.jsx("tbody",{children:t.data.length>0?t.data.map((a,s)=>e.jsxs("tr",{children:[e.jsx("td",{children:t.from+s}),e.jsx("td",{children:e.jsx("div",{className:"font-medium",children:a.nm_kec})}),e.jsx("td",{children:e.jsx("div",{className:"text-sm text-base-content/70",children:a.kab_kota?.nm_kab||"-"})}),e.jsx("td",{children:e.jsx("div",{className:"text-sm text-base-content/50",children:a.kab_kota?.provinsi?.nm_prov||"-"})}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>_(a),children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Ubah"]}),e.jsxs("button",{className:"btn btn-sm btn-error",onClick:()=>O(a),children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Hapus"]})]})})]},a.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-8 text-base-content/50",children:e.jsx("p",{children:"Tidak ada data kecamatan"})})})})]})}),t.links&&t.links.length>3&&e.jsx("div",{className:"card-body border-t border-base-300",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"text-sm text-base-content/70",children:["Menampilkan ",t.from," sampai ",t.to," dari ",t.total," data"]}),e.jsx("div",{className:"join",children:t.links.map((a,s)=>e.jsx(D,{href:a.url||"#",className:`join-item btn btn-sm ${a.active?"btn-active":a.url?"":"btn-disabled"}`,dangerouslySetInnerHTML:{__html:a.label}},s))})]})})]})})]}),e.jsx($,{id:"kecamatan-modal",isOpen:C,onClose:u,title:r?"Ubah Kecamatan":"Tambah Kecamatan",size:"md",footer:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(k,{variant:"ghost",onClick:u,disabled:c,children:"Batal"}),e.jsx(k,{type:"submit",variant:"primary",onClick:N,disabled:c,loading:c,children:r?"Simpan Perubahan":"Tambah"})]}),children:e.jsxs("form",{onSubmit:N,className:"space-y-4",noValidate:!0,children:[e.jsx(V,{levels:[{name:"prov_id",label:"Provinsi",options:S,optionValue:"id",optionLabel:"nm_prov",required:!0,placeholder:"Pilih Provinsi"},{name:"kab_id",label:"Kabupaten/Kota",options:f,optionValue:"id",optionLabel:a=>`${a.nm_kab} - ${a.provinsi?.nm_prov||""}`,dependsOn:"prov_id",foreignKey:"prov_id",required:!0,placeholder:"Pilih Kabupaten/Kota"}],values:h,onChange:(a,s)=>p(a,s),errors:x,disabled:c}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Nama Kecamatan ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsx("input",{type:"text",className:`input input-bordered w-full ${x.nm_kec?"input-error":""}`,placeholder:"Masukkan nama kecamatan",value:h.nm_kec,onChange:a=>p("nm_kec",a.target.value),disabled:c}),x.nm_kec&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:x.nm_kec})})]})]})}),e.jsx(I,{isOpen:M,onClose:()=>{m(!1),i(null)},onConfirm:A,title:"Hapus Kecamatan",message:`Apakah Anda yakin ingin menghapus "${r?.nm_kec}"?`,confirmText:"Hapus",cancelText:"Batal",variant:"error"})]})}export{ee as default};
