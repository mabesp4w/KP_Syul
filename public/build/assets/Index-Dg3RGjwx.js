import{u as R,r as b,z as w,j as e,H as G,a as j}from"./app-DtJ35xiz.js";import{M as H,C as Q}from"./ConfirmDialog-DwnvgXmc.js";import{B as g}from"./Button-MploRZnw.js";import{S as X}from"./SearchBox-CSScaDuk.js";import{A as Y}from"./AdminLayout-BH41KSEt.js";import{u as Z,o as ee,c as ae,d as u,e as se}from"./index.esm-BBRPuYfN.js";import{S as le}from"./SelectChain-AmMfXIqx.js";import"./Badge-bqPMSCrt.js";import"./AOSWrapper-CyGhR2Oq.js";const te=ae({kel_id:u().required("Kelurahan wajib dipilih"),nm_kegiatan:u().required("Nama kegiatan wajib diisi").max(255,"Nama kegiatan maksimal 255 karakter"),tgl_kegiatan:se().required("Tanggal kegiatan wajib diisi").typeError("Tanggal kegiatan harus berupa tanggal yang valid"),jam_mulai:u().nullable().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Format jam mulai harus HH:mm"),jam_seles:u().nullable().matches(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/,"Format jam selesai harus HH:mm").test("after-jam-mulai","Jam selesai harus setelah jam mulai",function(p){const{jam_mulai:c}=this.parent;if(!p||!c)return!0;const[y,k]=c.split(":").map(Number),[_,N]=p.split(":").map(Number),K=y*60+k;return _*60+N>K}),ket:u().nullable(),jenis:u().required("Jenis kegiatan wajib dipilih").oneOf(["pembelajaran","sosial","produktif","seni","lainnya"],"Jenis kegiatan tidak valid"),status:u().required("Status wajib dipilih").oneOf(["terjadwal","berlangsung","selesai"],"Status tidak valid")}),S=[{value:"pembelajaran",label:"Pembelajaran"},{value:"sosial",label:"Sosial"},{value:"produktif",label:"Produktif"},{value:"seni",label:"Seni"},{value:"lainnya",label:"Lainnya"}],T=[{value:"terjadwal",label:"Terjadwal"},{value:"berlangsung",label:"Berlangsung"},{value:"selesai",label:"Selesai"}];function he({auth:p,kegiatan:c,provinsi:y,kabKota:k,kecamatan:_,kelurahan:N,jenisList:K,filters:o}){const{flash:h}=R().props,[B,O]=b.useState(!1),[E,v]=b.useState(!1),[J,f]=b.useState(!1),[s,d]=b.useState(null);b.useEffect(()=>{h?.success&&w.success(h.success),h?.error&&w.error(h.error)},[h]);const{register:m,handleSubmit:A,reset:C,setValue:i,watch:F,formState:{errors:l,isSubmitting:$}}=Z({resolver:ee(te),defaultValues:{prov_id:"",kab_id:"",kec_id:"",kel_id:"",nm_kegiatan:"",tgl_kegiatan:"",jam_mulai:"",jam_seles:"",ket:"",jenis:"",status:"terjadwal"}}),q=F(),M=(a=null)=>{if(a){d(a);const t=N.find(x=>x.id===a.kel_id),n=t?_.find(x=>x.id===t.kec_id):null,r=n?k.find(x=>x.id===n.kab_id):null;i("prov_id",r?String(r.prov_id):""),i("kab_id",n?String(n.kab_id):""),i("kec_id",t?String(t.kec_id):""),i("kel_id",String(a.kel_id)),i("nm_kegiatan",a.nm_kegiatan),i("tgl_kegiatan",a.tgl_kegiatan?a.tgl_kegiatan.split("T")[0]:""),i("jam_mulai",a.jam_mulai?a.jam_mulai.substring(0,5):""),i("jam_seles",a.jam_seles?a.jam_seles.substring(0,5):""),i("ket",a.ket||""),i("jenis",a.jenis),i("status",a.status)}else d(null),C({prov_id:"",kab_id:"",kec_id:"",kel_id:"",nm_kegiatan:"",tgl_kegiatan:"",jam_mulai:"",jam_seles:"",ket:"",jenis:"",status:"terjadwal"});O(!0)},L=()=>{O(!1),d(null),C({prov_id:"",kab_id:"",kec_id:"",kel_id:"",nm_kegiatan:"",tgl_kegiatan:"",jam_mulai:"",jam_seles:"",ket:"",jenis:"",status:"terjadwal"})},z=a=>{const t={kel_id:a.kel_id,nm_kegiatan:a.nm_kegiatan,tgl_kegiatan:a.tgl_kegiatan,jam_mulai:a.jam_mulai||null,jam_seles:a.jam_seles||null,ket:a.ket||null,jenis:a.jenis,status:a.status};s?j.patch(`/admin/kegiatan/${s.id}`,t,{preserveScroll:!0,onSuccess:()=>{L()},onError:n=>{if(console.error("Update error:",n),n&&Object.keys(n).length>0&&!n.message){const r=Object.values(n)[0];w.error(Array.isArray(r)?r[0]:r)}}}):j.post("/admin/kegiatan",t,{preserveScroll:!0,onSuccess:()=>{C({prov_id:"",kab_id:"",kec_id:"",kel_id:"",nm_kegiatan:"",tgl_kegiatan:"",jam_mulai:"",jam_seles:"",ket:"",jenis:"",status:"terjadwal"})},onError:n=>{if(console.error("Create error:",n),n&&Object.keys(n).length>0&&!n.message){const r=Object.values(n)[0];w.error(Array.isArray(r)?r[0]:r)}}})},V=a=>{d(a),f(!0)},P=a=>{d(a),v(!0)},W=()=>{s&&j.delete(`/admin/kegiatan/${s.id}`,{preserveScroll:!0,onSuccess:()=>{v(!1),d(null)},onError:a=>{console.error("Delete error:",a),v(!1)}})},D=(a,t)=>{i(a,t)},I=a=>{const t=a.target.value;j.get("/admin/kegiatan",{...o,jenis:t||null},{preserveState:!0,replace:!0})},U=a=>{const t=a.target.value;j.get("/admin/kegiatan",{...o,status:t||null},{preserveState:!0,replace:!0})};return e.jsxs(Y,{auth:p,children:[e.jsx(G,{title:"Manajemen Kegiatan"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center","data-aos":"fade-down",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-base-content",children:"Kegiatan"}),e.jsx("p",{className:"mt-1 text-base-content/70",children:"Kelola data kegiatan program pendidikan"})]}),e.jsxs(g,{onClick:()=>M(),className:"btn-primary",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})}),"Tambah Kegiatan"]})]}),e.jsx("div",{className:"card bg-base-100 shadow-sm","data-aos":"fade-up","data-aos-delay":"100",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"grid grid-cols-1 items-end justify-end gap-4 md:grid-cols-3",children:[e.jsx(X,{placeholder:"Cari kegiatan...",defaultValue:o?.search||"",route:"/admin/kegiatan",routeParams:o,debounceMs:500}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Filter Jenis"})}),e.jsxs("select",{className:"select-bordered select w-full",value:o?.jenis||"",onChange:I,children:[e.jsx("option",{value:"",children:"Semua Jenis"}),K.map(a=>e.jsx("option",{value:a,children:S.find(t=>t.value===a)?.label||a},a))]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Filter Status"})}),e.jsxs("select",{className:"select-bordered select w-full",value:o?.status||"",onChange:U,children:[e.jsx("option",{value:"",children:"Semua Status"}),T.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]})]})]})})}),e.jsx("div",{className:"card bg-base-100 shadow-sm","data-aos":"fade-up","data-aos-delay":"200",children:e.jsx("div",{className:"card-body p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table table-zebra",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Nama Kegiatan"}),e.jsx("th",{children:"Tanggal & Waktu"}),e.jsx("th",{children:"Jenis"}),e.jsx("th",{children:"Kelurahan"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Aksi"})]})}),e.jsx("tbody",{children:c.data.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"py-8 text-center text-base-content/70",children:"Tidak ada data kegiatan"})}):c.data.map((a,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:c.from+t}),e.jsxs("td",{children:[e.jsx("div",{className:"font-medium",children:a.nm_kegiatan}),a.ket&&e.jsx("div",{className:"line-clamp-1 text-sm text-base-content/70",children:a.ket})]}),e.jsxs("td",{children:[e.jsx("div",{children:a.tgl_kegiatan?new Date(a.tgl_kegiatan).toLocaleDateString("id-ID"):"-"}),a.jam_mulai&&a.jam_seles&&e.jsxs("div",{className:"text-sm text-base-content/70",children:[a.jam_mulai.substring(0,5)," - ",a.jam_seles.substring(0,5)]})]}),e.jsx("td",{children:e.jsx("span",{className:"badge badge-outline",children:S.find(n=>n.value===a.jenis)?.label||a.jenis})}),e.jsx("td",{children:a.kelurahan?.nm_kel||"-"}),e.jsxs("td",{children:[a.status==="terjadwal"&&e.jsx("span",{className:"badge badge-info",children:"Terjadwal"}),a.status==="berlangsung"&&e.jsx("span",{className:"badge badge-warning",children:"Berlangsung"}),a.status==="selesai"&&e.jsx("span",{className:"badge badge-success",children:"Selesai"})]}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"btn btn-ghost btn-sm",onClick:()=>V(a),title:"Detail",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})}),e.jsx("button",{className:"btn btn-ghost btn-sm",onClick:()=>M(a),title:"Edit",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx("button",{className:"btn btn-ghost btn-sm text-error",onClick:()=>P(a),title:"Hapus",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]},a.id))})]})})})}),c.links.length>3&&e.jsx("div",{className:"flex justify-center","data-aos":"fade-up","data-aos-delay":"300",children:e.jsx("div",{className:"join",children:c.links.map((a,t)=>e.jsx("button",{className:`btn join-item ${a.active?"btn-active":""} ${a.url?"":"btn-disabled"}`,onClick:()=>a.url&&j.get(a.url),dangerouslySetInnerHTML:{__html:a.label}},t))})}),e.jsx(H,{isOpen:B,onClose:L,title:s?"Edit Kegiatan":"Tambah Kegiatan",size:"5xl",children:e.jsxs("form",{onSubmit:A(z),className:"space-y-4",children:[e.jsx(le,{levels:[{name:"prov_id",label:"Provinsi",options:y,optionValue:"id",optionLabel:"nm_prov",required:!0},{name:"kab_id",label:"Kabupaten/Kota",options:k,optionValue:"id",optionLabel:"nm_kab",dependsOn:"prov_id",foreignKey:"prov_id",required:!0},{name:"kec_id",label:"Kecamatan",options:_,optionValue:"id",optionLabel:"nm_kec",dependsOn:"kab_id",foreignKey:"kab_id",required:!0},{name:"kel_id",label:"Kelurahan",options:N,optionValue:"id",optionLabel:"nm_kel",dependsOn:"kec_id",foreignKey:"kec_id",required:!0}],values:q,onChange:D,errors:l,gridLayout:[[0,1],[2,3]]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Nama Kegiatan ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsx("input",{type:"text",className:`input-bordered input w-full ${l.nm_kegiatan?"input-error":""}`,...m("nm_kegiatan"),placeholder:"Masukkan nama kegiatan"}),l.nm_kegiatan&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:l.nm_kegiatan.message})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Tanggal Kegiatan ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsx("input",{type:"date",className:`input-bordered input w-full ${l.tgl_kegiatan?"input-error":""}`,...m("tgl_kegiatan")}),l.tgl_kegiatan&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:l.tgl_kegiatan.message})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Jenis Kegiatan ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsxs("select",{className:`select-bordered select w-full ${l.jenis?"select-error":""}`,...m("jenis"),children:[e.jsx("option",{value:"",children:"Pilih Jenis Kegiatan"}),S.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),l.jenis&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:l.jenis.message})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Jam Mulai (Opsional)"})}),e.jsx("input",{type:"time",className:`input-bordered input w-full ${l.jam_mulai?"input-error":""}`,...m("jam_mulai")}),l.jam_mulai&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:l.jam_mulai.message})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Jam Selesai (Opsional)"})}),e.jsx("input",{type:"time",className:`input-bordered input w-full ${l.jam_seles?"input-error":""}`,...m("jam_seles")}),l.jam_seles&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:l.jam_seles.message})})]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Keterangan (Opsional)"})}),e.jsx("textarea",{className:`textarea-bordered textarea w-full ${l.ket?"textarea-error":""}`,...m("ket"),placeholder:"Masukkan keterangan kegiatan",rows:"4"}),l.ket&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:l.ket.message})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Status ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsxs("select",{className:`select-bordered select w-full ${l.status?"select-error":""}`,...m("status"),children:[e.jsx("option",{value:"",children:"Pilih Status"}),T.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),l.status&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:l.status.message})})]}),e.jsxs("div",{className:"modal-action",children:[e.jsx(g,{type:"button",onClick:L,className:"btn-ghost",children:"Batal"}),e.jsx(g,{type:"submit",className:"btn-primary",disabled:$,children:$?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"loading loading-sm loading-spinner"}),s?"Menyimpan...":"Menambahkan..."]}):s?"Simpan Perubahan":"Tambah Kegiatan"})]})]})}),e.jsx(H,{isOpen:J,onClose:()=>{f(!1),d(null)},title:"Detail Kegiatan",size:"4xl",children:s&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4 pb-4 border-b border-base-300",children:[e.jsx("div",{className:"avatar placeholder",children:e.jsx("div",{className:"bg-primary text-primary-content rounded-full w-16",children:e.jsx("span",{className:"text-2xl",children:s.nm_kegiatan?.charAt(0).toUpperCase()||"K"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:s.nm_kegiatan}),e.jsx("p",{className:"text-sm text-base-content/70",children:s.tgl_kegiatan?new Date(s.tgl_kegiatan).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"-"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-base-content/70",children:"Jenis Kegiatan"}),e.jsx("p",{className:"mt-1",children:e.jsx("span",{className:"badge badge-outline badge-lg",children:S.find(a=>a.value===s.jenis)?.label||s.jenis})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-base-content/70",children:"Waktu Kegiatan"}),e.jsx("p",{className:"mt-1",children:s.jam_mulai&&s.jam_seles?`${s.jam_mulai.substring(0,5)} - ${s.jam_seles.substring(0,5)}`:s.jam_mulai?`Mulai: ${s.jam_mulai.substring(0,5)}`:"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-base-content/70",children:"Status"}),e.jsxs("p",{className:"mt-1",children:[s.status==="terjadwal"&&e.jsx("span",{className:"badge badge-info badge-lg",children:"Terjadwal"}),s.status==="berlangsung"&&e.jsx("span",{className:"badge badge-warning badge-lg",children:"Berlangsung"}),s.status==="selesai"&&e.jsx("span",{className:"badge badge-success badge-lg",children:"Selesai"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-base-content/70",children:"Kelurahan"}),e.jsxs("p",{className:"mt-1",children:[s.kelurahan?.nm_kel||"-",s.kelurahan?.kecamatan&&e.jsxs("span",{className:"text-sm text-base-content/70",children:[s.kelurahan.nm_kel?", ":"",s.kelurahan.kecamatan.nm_kec,s.kelurahan.kecamatan.kab_kota&&e.jsxs(e.Fragment,{children:[", ",s.kelurahan.kecamatan.kab_kota.nm_kab,s.kelurahan.kecamatan.kab_kota.provinsi&&e.jsxs(e.Fragment,{children:[", ",s.kelurahan.kecamatan.kab_kota.provinsi.nm_prov]})]})]})]})]}),s.ket&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-base-content/70",children:"Keterangan"}),e.jsx("p",{className:"mt-1 whitespace-pre-wrap",children:s.ket})]})]})]}),e.jsxs("div",{className:"modal-action",children:[e.jsxs(g,{type:"button",onClick:()=>{f(!1),M(s)},className:"btn-primary",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"mr-2 h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Edit Kegiatan"]}),e.jsx(g,{type:"button",onClick:()=>{f(!1),d(null)},className:"btn-ghost",children:"Tutup"})]})]})}),e.jsx(Q,{isOpen:E,onClose:()=>{v(!1),d(null)},onConfirm:W,title:"Hapus Kegiatan",message:`Apakah Anda yakin ingin menghapus kegiatan "${s?.nm_kegiatan}"?`})]})]})}export{he as default};
